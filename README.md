# PCDR-SKYFALL

PCDR-SKYFALL is a modified version of the SKYFALL risk analyzer for Low-earth orbit (LEO) satellite networks (LSNs).  
It extends the original SKYFALL simulator from the paper  
“Time-varying Bottleneck Links in LEO Satellite Networks: Identification, Exploits, and Countermeasures” (NDSS 2025)  
to evaluate **Probabilistic Chunk-Dispersed Routing (PCDR)** and **K-DS multipath routing** against link-flooding attacks (LFAs).

The original SKYFALL artifact and data are available at DOI: 10.5281/zenodo.13978898 (https://doi.org/10.5281/zenodo.13978898).

---

## What is PCDR-SKYFALL?

PCDR-SKYFALL helps you analyze how different routing schemes, including PCDR,  
affect bottleneck ground-satellite links (GSLs) and the impact of link-flooding attacks (LFAs)  
on legal background traffic in LEO satellite networks.

Compared to the original SKYFALL analyzer, this version adds:

- A **PCDR routing module** (Probabilistic Chunk-Dispersed Routing)
- A **K-DS (k Disjoint Satellite-to-satellite paths)** routing option
- A unified experiment launcher (`test_start.sh`)
- A plotting script (`graph.py`) that compares:
  - Original single-path routing
  - Multiple PCDR parameter settings
  - K-DS routing

---

## Components

This repository contains:

1. A configuration file (e.g., `config.json`).
2. A code directory (the original SKYFALL core, extended with PCDR/K-DS).
3. A main experiment script:  
   - `test_start.sh` – runs the full simulation pipeline for a given duration and thread count.
4. A plotting script:
   - `graph.py` – generates comparison figures for different routing schemes.
5. Experiment output directories generated by `test_start.sh`, for example:

   - `test_04_original_3600/` – Original routing, 3600-second run  
   - `test_04_3600/` – PCDR with baseline parameters (e.g., p=0.8, S=0.05)  
   - `test_04_08_001_3600/` – PCDR with S=0.01  
   - `test_04_08_010_3600/` – PCDR with S=0.10  
   - `test_04_K-DS_100/` – K-DS routing run (e.g., k=10)

These directories are referenced by `graph.py` via the `TESTS` list.

---

## Preparation

PCDR-SKYFALL has similar requirements to the original SKYFALL artifact.

1. A high-performing server with multiple cores per processor is recommended.  
   For example, the authors ran experiments on a DELL R740 server  
   with two Intel Xeon 5222 processors (64 logical processors in total) and 8×32 GB DDR4 RAM.

2. If only a commodity desktop machine is available
   (e.g., x86-64 CPU with 8 cores and 16 GB of RAM),
   you can still run a shorter demo by using a smaller attack period (e.g., 100 seconds).

3. Operating system: CentOS 7.9.2009 or Ubuntu 18.04 or above.

4. Python 3.6 or above.

If you reuse the original SKYFALL datasets (`starlink_shell_one-3600-backup`, `starlink_shell_one-100-backup`),
make sure they are extracted to the location expected by the scripts (same layout as the original SKYFALL artifact).

---

## Installation

You can follow the same installation procedure as the original SKYFALL artifact.

- Direct installation in the system Python environment:

  ```bash
  bash ./install.sh
  ```

  This will install the required Python packages, such as:

  - `setuptools`, `xlrd`, `argparse`, `numpy`, `requests`,  
    `skyfield`, `sgp4`, and other standard libraries.

- Or, if you prefer a Conda virtual environment:

  ```bash
  bash ./install_venv.sh
  conda create --name myenv python=3.8 setuptools xlrd argparse numpy requests skyfield sgp4
  conda activate myenv
  ```

Make sure the environment you activate when running the simulator
is the same one you used for installing the dependencies.

---

## Getting started

### 1. Configure the scenario

Edit `config.json` if needed.  
By default, we use Starlink shell-one satellites (72×22 satellites) as in the original SKYFALL paper.

You can adjust:

- Constellation parameters (shell, number of satellites, etc.)
- Traffic configuration (legal background traffic, attacker settings)
- Simulation options (topology, time resolution, etc.)

---

### 2. Run the PCDR-SKYFALL simulator

PCDR-SKYFALL provides a unified entry script:

```bash
bash test_start.sh [DURATION_SECONDS] [NUM_THREADS]
```

Examples:

- Full 1-hour experiment (3600 seconds) with 64 threads:

  ```bash
  bash test_start.sh 3600 64
  ```

- Short demo (100 seconds) with 8 threads:

  ```bash
  bash test_start.sh 100 8
  ```

The script will:

1. Build satellite LLA (latitude, longitude, altitude) data for each time slot.
2. Generate legal background traffic over the constellation.
3. Run LFA-style attack traffic and routing under various schemes:
   - Original routing
   - PCDR with multiple parameter settings
   - K-DS routing
4. Store the results under dedicated directories such as:

   - `./test_04_original_<DURATION>/`
   - `./test_04_<DURATION>/`
   - `./test_04_08_001_<DURATION>/`
   - `./test_04_08_010_<DURATION>/`
   - `./test_04_K-DS_<DURATION>/`

(Directory names may be adapted to your experiments; see the `TESTS` list in `graph.py`.)

---

### 3. Generate graphs

Once the simulations have finished and all `test_*/` directories are generated,
run the plotting script:

```bash
python3 graph.py
```

`graph.py` will:

- Load result files from the directories specified in `TESTS`
- Generate comparison plots for:
  - Throughput loss of legal background traffic
  - Number of congested GSLs
  - Attack cost or bot requirements (depending on your metrics)
- Save the figures under an output directory such as:

  ```text
  ./outputs/<timestamp>/paper_figures/
  ```

Please check the console log of `graph.py` for the exact output paths.

---

## Customization

### 1. Changing which experiments appear in the plots (`graph.py`)

At the top of `graph.py`, you will find:

```python
TESTS = [
    ("Original Routing",          Path("./test_04_original_3600")),
    ("PCDR (p=0.8, S=0.05)",      Path("./test_04_3600")),
    ("PCDR (p=0.8, S=0.01)",      Path("./test_04_08_001_3600")),
    ("PCDR (p=0.8, S=0.10)",      Path("./test_04_08_010_3600")),
    ("K-DS",                      Path("./test_04_K-DS_100")),
]
```

- The first element of each tuple is the **legend label** in the graphs.
- The second element is the **path to the experiment result directory**.

To customize your plots:

- Change the **labels** to reflect your routing schemes or parameter settings.
- Change the **paths** to point to your own experiment directories created by `test_start.sh`.
- Comment out or remove entries if you do not want to plot them.
- Add new entries for additional PCDR or K-DS experiments.

Make sure the directory names match the actual folder names created by your runs.

---

### 2. Tuning routing behavior (`generate_flow_grid.py`)

`generate_flow_grid.py` contains switches and parameters for K-DS and PCDR.

#### K-DS routing (satellite-to-satellite disjoint paths)

```python
# ==== K-DS switches (no packet splitting) ====
KDS_ENABLE = True            # Enable k-DS routing
KDS_K = 10                   # Number of candidate disjoint paths k
KDS_NODE_DISJOINT = True     # True: node-disjoint (no shared satellites), False: link-disjoint
KDS_CHECK_ALL_CAPS = False   # False: check DL only, True: check UL/ISL/DL capacities
```

- Set `KDS_ENABLE = True` to enable K-DS routing.
- `KDS_K` controls how many candidate disjoint paths are considered.
- `KDS_NODE_DISJOINT` switches between node-disjoint and link-disjoint constraints.
- `KDS_CHECK_ALL_CAPS` lets you choose whether to pre-check only downlinks or all link types.

K-DS caches are stored in:

```python
KDS_PATHSET_CACHE = {}       # {(src, landing, k, node_disjoint): [paths...]}
KDS_RR_IDX = {}              # {(src, landing, k, node_disjoint): next_index}
```

You normally do not need to modify these dictionaries;  
they are used internally for caching and round-robin selection of paths.

#### PCDR routing (Probabilistic Chunk-Dispersed Routing)

```python
# ==== PCDR switches ====
PCDR_ENABLE = False          # Turn PCDR on/off
PCDR_P = 0.8                 # Probability weight p (0~1) used in dynamic n calculation
PCDR_MIN_CHUNK = 0.2         # [Mb] minimum chunk size (should match flow size granularity)
PCDR_MAX_K = 64              # Max number of equal-cost shortest paths to sample at once

rng = random.Random(20250917)  # Reproducibility seed

# Candidate landing satellites (same GS) for distribution
PCDR_CANDIDATE_SLACK = 1
PCDR_MAX_CANDIDATES = 8
PCDR_CROSS_GS = True         # Allow landing at different GSes or not (default: False in strict setting)

assert KDS_K <= PCDR_MAX_K, "KDS_K must be <= PCDR_MAX_K"
```

- Set `PCDR_ENABLE = True` to enable PCDR.
- `PCDR_P` controls how aggressively the number of chunks `n` is randomized around the minimum value.
- `PCDR_MIN_CHUNK` defines the smallest chunk size; it should be consistent with your flow size.
- `PCDR_MAX_K` is the upper bound on the number of equal-cost shortest paths that PCDR can use.

Landing satellite diversification:

- `PCDR_CANDIDATE_SLACK` limits how far from the shortest landing path (in hops) candidates can deviate.
- `PCDR_MAX_CANDIDATES` caps how many candidate landing satellites are considered.
- `PCDR_CROSS_GS` allows or forbids sending chunks to satellites attached to different GSes.

The random generator `rng` is initialized with a fixed seed for reproducibility;  
you can change the seed if you want different stochastic realizations.

---

## Example usage patterns

- **Original routing only**  

  ```python
  KDS_ENABLE = False
  PCDR_ENABLE = False
  ```

- **K-DS only**

  ```python
  KDS_ENABLE = True
  PCDR_ENABLE = False
  ```

- **PCDR only**

  ```python
  KDS_ENABLE = False
  PCDR_ENABLE = True
  ```

- **Combined experiments**

  Run multiple configurations by changing these switches and parameters,
  assigning each configuration its own output directory via `test_start.sh`,
  and then adding them as separate entries in `TESTS` inside `graph.py`.

---

## How to run a small demo

If running long experiments (e.g., 3600 seconds with many threads) is too heavy for your machine,
you can still exercise the entire pipeline with a shorter attack period, such as 100 seconds:

```bash
bash test_start.sh 100 8
python3 graph.py
```

You will get a smaller dataset and faster runs, but the full PCDR/K-DS routing  
and plotting pipeline will still be executed.

---

## Results

Running `test_start.sh` followed by `python3 graph.py`  
allows you to evaluate and compare:

- The throughput degradation of legal background traffic under LFAs
- The number of congested GSLs over time
- The attack cost (e.g., number of bots or malicious terminals)  
  required to achieve a given degradation level

PCDR-SKYFALL thus enables you to study how probabilistic chunk-dispersed routing  
and multipath strategies like K-DS can increase the difficulty and cost of link-flooding attacks  
in low-Earth orbit satellite networks.
